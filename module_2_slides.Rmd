---
title: "Module 2: Exploring & Summarizing Data"
author: ""
date: "`r Sys.Date()`"
output: 
  xaringan::moon_reader:
    lib_dir: libs
    css: xaringan-themer.css
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---


<style type="text/css">
.remark-slide-content {
    font-size: 30px;
}
</style>
```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo=T, 
  eval = F,
  message = F, 
  warning = F, 
  comment = NA,
  R.options=list(width=120), 
  cache.rebuild=F, 
  cache=T,
  fig.align='center', 
  fig.asp = .7,
  dev = 'svg', 
  dev.args=list(bg = 'transparent')
)

library(tidyverse); library(broom); library(kableExtra); library(visibly)

kable_df <- function(..., digits=3) {
  kable(..., digits=digits) %>% 
    kable_styling(full_width = F)
}

rnd = function(x, digits = 3) arm::fround(x, digits = digits)
```

## Introduction

---
## Quick Summary

```{r}
glimpse(starwars)
summary(starwars[,1:10])

```



## Grouping and Summarizing Operations

A very common operation is to do things by group(s) then create new summary variables.

```{r group_by, eval=TRUE}
starwars %>% 
  group_by(homeworld) %>% 
  summarise(height = mean(height, na.rm = T),
            mass = mean(mass, na.rm = T)) 
```

## Grouping and Summarizing Operations

Can do multiple operations at once

```{r group_by2, eval=TRUE}
mtcars %>% 
  group_by(cyl) %>% 
  summarise(Mean = mean(mpg),
            `Std. Dev.` = sd(mpg),
            Max = max(mpg)) 
```

---

##  Mapping functions to groups


The <span class="pack">purrr</span> package

Consider the following. We’ll use the <span class="func">map</span> function to map the <span class="func">sum</span> function to each element in the list

```{r map}
x = list(1:3, 4:6, 7:9)
map(x, sum)
```

---

## Grouping and Summarizing Operations

Even models

```{r group_by3, eval=TRUE, results='hold'}
mpg %>% 
  group_split(year) %>% 
  map(~coef(lm(hwy ~ cty, data = .))) 

mpg %>% 
  group_by(year) %>% 
  group_map(~coef(lm(hwy ~ cty, data = .)))
```

---
## Visualization

the information you want to display, and then how you want to display it in order to tell the data’s story.

---

## Things to think about

- Color
- Contrast
- Size
- Transparency
- Legibility
- Accessibility
- File types

## ggplot2

The most widely used visualization package in R

Copied into other realms (e.g. Python)

## Layers

---

## More pipes

---

## Aesthetics

---

## Geoms

---

## Stats

---

## Scales

---

## Facets

---

## Interactivity

---

## Interactivity


General 

- [plotly](https://plot.ly/r/)
  - used also in Python, Matlab, Julia
  - can convert <span class="pack">ggplot2</span> images to interactive ones (with varying degrees of success)
- [highcharter](http://jkunst.com/highcharter/)
  - also very general wrapper for highcharts.js and works with some R packages out of the box
- [rbokeh](http://hafen.github.io/rbokeh/)
  - like plotly, it also has cross language support

---

## Interactivity

Specific functionality:

- [DT](https://rstudio.github.io/DT/)
  - interactive data tables
- [leaflet](https://rstudio.github.io/leaflet/)
    - maps with OpenStreetMap
- [visNetwork](http://datastorm-open.github.io/visNetwork/)
    - Network visualization
    
---

## Plotly

plotly has modes, which allow for points, lines, text and combinations. Traces, add_*, work similar to geoms.

---

## Plotly

```{r plotly}
library(plotly)
midwest %>% 
  filter(inmetro==T) %>% 
  plot_ly(x=~percbelowpoverty, y=~percollege) %>% 
  add_markers()
```

---
## Plotly

```{r}
library(mgcv); library(modelr); library(glue)

mtcars %>% 
  mutate(amFactor = factor(am, labels=c('auto', 'manual')),
         hovertext = glue('weight: {wt} <br> mgp:  {mpg} <br> {amFactor}')) %>% 
  add_predictions(gam(mpg~s(wt, am, bs='fs'), data=mtcars)) %>% 
  plot_ly() %>%
  add_markers(x=~wt, 
              y=~mpg, 
              color=~amFactor, 
              opacity=.5, 
              text=~hovertext, 
              hoverinfo='text', 
              showlegend=F) %>% 
  add_lines(x=~wt, 
            y=~pred, 
            color=~amFactor, 
            name='gam prediction')
```

---

## Plotly


One of the strengths of plotly is that we can feed a ggplot object to it, and turn our formerly static plots into interactive ones. 

```{r}
gp = mtcars %>% 
  mutate(amFactor = factor(am, labels=c('auto', 'manual')),
         hovertext = paste(wt, mpg, amFactor)) %>% 
  arrange(wt) %>% 
  ggplot(aes(x=wt, y=mpg, color=amFactor)) +
  geom_smooth(se=F) +
  geom_point(aes(color=amFactor))
ggplotly()
```

---